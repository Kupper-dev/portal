exports.id=951,exports.ids=[951],exports.modules={3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(71237),e=c(55088),f=c(17679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},30886:(a,b,c)=>{"use strict";c.d(b,{qF:()=>h,Cv:()=>i,vi:()=>n,UG:()=>k});var d=c(88908);let e=[{appId:0x1d0525c,token:process.env.PODIO_TOKEN_CUSTOMERS||process.env.PODIO_APP_TOKEN_CUSTOMERS||"",name:"customers",urlLabel:"customers"},{appId:0x1d0525d,token:process.env.PODIO_TOKEN_DEVICES||"",name:"devices",urlLabel:"devices"},{appId:0x1d05274,token:process.env.PODIO_TOKEN_SERVICES||"",name:"services",urlLabel:"services"},{appId:0x1d052a0,token:process.env.PODIO_TOKEN_SERVICE_OR_SPARE_PART||"",name:"service_or_spare_part",urlLabel:"serviceorsparepart"},{appId:0x1d052b9,token:process.env.PODIO_TOKEN_STORE||"",name:"store",urlLabel:"store"},{appId:0x1d052cd,token:process.env.PODIO_TOKEN_GAMER||"",name:"gamer",urlLabel:"gamer"},{appId:0x1d052e6,token:process.env.PODIO_TOKEN_ACQUIRED_DEVICES||"",name:"acquired_devices",urlLabel:"acquireddevices"},{appId:0x1d052e7,token:process.env.PODIO_TOKEN_QUOTATIONS||"",name:"quotations",urlLabel:"quotations"},{appId:0x1d0531a,token:process.env.PODIO_TOKEN_PLANS||"",name:"plans",urlLabel:"plans"},{appId:0x1d0c0b8,token:process.env.PODIO_TOKEN_INVOICES||"",name:"invoices",urlLabel:"invoices"},{appId:0x1d05bbb,token:process.env.PODIO_TOKEN_APPOINTMENTS||"",name:"appointments",urlLabel:"appointments"},{appId:0x1d0a9c8,token:process.env.PODIO_TOKEN_TICKETS||"",name:"tickets",urlLabel:"tickets"},{appId:0x1d05b29,token:process.env.PODIO_TOKEN_STUDENTS||process.env.PODIO_APP_TOKEN_STUDENTS||"",name:"students",urlLabel:"students"},{appId:0x1d05b2a,token:process.env.PODIO_TOKEN_COURSES||"",name:"courses",urlLabel:"courses"},{appId:0x1d05b31,token:process.env.PODIO_TOKEN_CLASSES||"",name:"classes",urlLabel:"classes"},{appId:0x1d05b33,token:process.env.PODIO_TOKEN_ENROLLMENTS||"",name:"enrollments",urlLabel:"enrollments"},{appId:0x1d0a904,token:process.env.PODIO_TOKEN_CHAPTERS||"",name:"chapters",urlLabel:"chapters"},{appId:0x1d2bca1,token:process.env.PODIO_TOKEN_TECHNICIANS||"",name:"technicians",urlLabel:"technicians"}];function f(a){return e.find(b=>b.appId===a)}class g{constructor(a){this.accessToken=null,this.apiBase="https://api.podio.com",this.authType=a.authType,this.clientId=a.clientId,this.clientSecret=a.clientSecret,this.appId=a.appId,this.appToken=a.appToken}async authenticateWithApp(a,b){return this.authType="app",this.appId=a,this.appToken=b,this.authenticate()}async authenticateWithRefreshToken(a){return this.authType="user",this.userRefreshToken=a,this.performAuth(new URLSearchParams({grant_type:"refresh_token",refresh_token:a,client_id:this.clientId,client_secret:this.clientSecret}))}async authenticateWithPassword(a,b){return this.authType="user",this.userEmail=a,this.userPassword=b,this.performAuth(new URLSearchParams({grant_type:"password",username:a,password:b,client_id:this.clientId,client_secret:this.clientSecret}))}async performAuth(a){let b=await fetch(`${this.apiBase}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!b.ok){let a=await b.text();throw Error(`Podio Auth Failed: ${b.status} ${b.statusText} - ${a}`)}let c=await b.json();return this.accessToken=c.access_token,c.refresh_token&&(this.userRefreshToken=c.refresh_token),c}async authenticate(){if("app"===this.authType){if(!this.appId||!this.appToken)throw Error("App ID and Token required for app auth");return this.performAuth(new URLSearchParams({grant_type:"app",app_id:this.appId.toString(),app_token:this.appToken,client_id:this.clientId,client_secret:this.clientSecret}))}}async get(a){return this.request("GET",a)}async post(a,b){return this.request("POST",a,b)}async put(a,b){return this.request("PUT",a,b)}async delete(a){return this.request("DELETE",a)}async request(a,b,c){if(!this.accessToken)if("app"===this.authType)await this.authenticate();else if("user"===this.authType&&this.userRefreshToken)await this.authenticateWithRefreshToken(this.userRefreshToken);else throw Error("Not authenticated and cannot auto-auth");let d=b.startsWith("/")?b:`/${b}`,e=`${this.apiBase}${d}`,f={Authorization:`OAuth2 ${this.accessToken}`,Accept:"application/json"};c&&(f["Content-Type"]="application/json");let g={method:a,headers:f,body:c?JSON.stringify(c):void 0},h=await fetch(e,g);if(204!==h.status&&(200!==h.status||"0"!==h.headers.get("content-length"))){if(401===h.status){console.log("Token expired, retrying..."),this.accessToken=null,"app"===this.authType?await this.authenticate():"user"===this.authType&&this.userRefreshToken&&await this.authenticateWithRefreshToken(this.userRefreshToken),g.headers.Authorization=`OAuth2 ${this.accessToken}`;let a=await fetch(e,g);if(!a.ok){let b=await a.text();throw Error(`Request failed after retry: ${a.status} ${b}`)}return a.json()}if(!h.ok){let a=await h.text();if(404===h.status)return null;throw Error(`Podio Request Failed: ${h.status} ${a}`)}return h.json()}}async updateItemFieldValue(a,b,c,d=!0){return this.request("PUT",`/item/${a}/value/${b}`,{value:c,silent:d,hook:!d})}}async function h(a){let b=process.env.PODIO_CLIENT_ID,c=process.env.PODIO_CLIENT_SECRET;if(!b||!c)throw Error("PODIO_CLIENT_ID or PODIO_CLIENT_SECRET not set");let d=f(a);if(!d)throw Error(`App ID ${a} not found in generated config.`);if(!d.token)throw Error(`App Token missing for App ID ${a} (${d.name}). Please check .env or config.`);let e=new g({authType:"app",clientId:b,clientSecret:c,appId:d.appId,appToken:d.token});return await e.authenticate(),e}async function i(a,b){console.log(`Verifying hook ${a} with code ${b}...`);let c=!1;for(let d of e)if(d.token)try{console.log(`Trying to verify with App: ${d.name} (${d.appId})...`);let e=await h(d.appId);await e.request("POST",`/hook/${a}/verify/validate`,{code:b}),console.log(`Hook ${a} verified successfully with App: ${d.name}`),c=!0;break}catch(a){}if(!c)throw console.error(`Failed to verify hook ${a} with ANY configured app.`),Error("Hook verification failed for all apps");return!0}async function j(a,b){if(b){try{let c=await h(b),d=await c.request("GET",`/item/${a}`),e=f(b);if(d&&e)return{appConfig:e,data:d}}catch(c){console.error(`Failed to fetch item ${a} using webhook app ID ${b}`,c)}return null}for(let b of e)if(b.token)try{let c=await h(b.appId),d=await c.request("GET",`/item/${a}`);if(d&&d.app.app_id===b.appId)return{appConfig:b,data:d}}catch(a){console.error(`Error fetching from App ${b.name} (${b.appId}):`,a)}return console.warn(`Could not fetch Podio Item ${a} from any configured Apps.`),null}async function k(a,b,c,f){let g=(0,d._)();console.log(`Syncing Podio Item ${a} to Supabase...`);let h=null;if(f&&c){let a=e.find(a=>a.appId===c);a&&(h={appConfig:a,data:f})}if(h||(h=await j(a,c)),!h)return void console.error(`Item ${a} not found in supported Apps.`);let{appConfig:i,data:k}=h;console.log(`Identified Item ${a} as belonging to '${i.urlLabel}' (${i.name}).`);let l=function(a,b){let c={podio_item_id:b.item_id,podio_app_item_id:b.app_item_id,podio_formatted_id:b.app_item_id_formatted,last_updated_at:new Date().toISOString()};for(let a of b.fields){let b=a.external_id.replace(/[^a-z0-9]/gi,"_").toLowerCase(),d=a.external_id.replace(/[^a-z0-9]/gi,"").toLowerCase();["servicetype","databackup","poweradapter","accessories","advancepayment","datereceived","datecheckupstart","datediagnosed","datepartsordered","daterepairstart","daterepairready","datedevicedelivered"].includes(d)&&(b=d);let e=null,f=a.values||[];if(f.length>0)if("app"===a.type)e=f.map(a=>a.value?.item_id).filter(a=>void 0!==a);else if("contact"===a.type)e=f.map(a=>a.value?.name).filter(a=>a);else if("category"===a.type){let a=f.map(a=>a.value?.text||a.value?.id).filter(a=>a);e=a.length>0?a.join(", "):null}else"date"===a.type?e=f[0].start:("location"===a.type||a.type,e=f[0].value);null!=e&&(c[b]=e)}return c}(0,k),n=i.name.replace(/-/g,"_").toLowerCase(),{error:o}=await g.from(n).upsert(l,{onConflict:"podio_item_id"});o?console.error(`Error syncing to Supabase table ${n}:`,o):(console.log(`Successfully synced Item ${a} to table ${n}.`),"services"===i.name&&await m(i,k))}let l={"Dispositivo recibido":"datereceived","Dispositivo recibido ":"datereceived","Dispositivo en revisi\xf3n":"datecheckupstart","En revisi\xf3n":"datecheckupstart","Diagn\xf3stico listo":"datediagnosed","Enviar diagn\xf3stico":"datediagnosed","Enviar diagnostico":"datediagnosed","Diagnostico enviado":"datediagnosed","Refacciones en camino":"datepartsordered","Esperando refacciones":"datepartsordered","Inicia reparaci\xf3n":"daterepairstart","Reparaci\xf3n finalizada":"daterepairready","Dispositivo entregado":"datedevicedelivered","Dispositivo entregado sin reparar":"datedevicedelivered"};async function m(a,b){let c=b.fields.find(a=>"status"===a.external_id),d=c?.values?.[0]?.value?.text;if(!d)return;let e=l[d]||l[d.trim()];if(!e)return void console.log(`No timestamp mapping found for status: '${d}'`);let f=b.fields.find(a=>a.external_id===e);if(f&&f.values&&f.values.length>0)return void console.log(`Timestamp '${e}' already exists. Skipping.`);console.log(`Auto-timestamping '${e}' for status '${d}'...`);let g=new Date().toISOString().replace("T"," ").split(".")[0];try{let c=await h(a.appId);await c.updateItemFieldValue(b.item_id,e,{start:g}),console.log(`Successfully updated '${e}' with '${g}'.`)}catch(a){console.error(`Failed to auto-timestamp item ${b.item_id}:`,a)}}async function n(){return console.log("Outbound sync not yet fully implemented for multi-app."),{synced:0,message:"Not implemented for multi-app"}}},78335:()=>{},88908:(a,b,c)=>{"use strict";c.d(b,{_:()=>e});var d=c(81742);let e=()=>{let a=process.env.NEXT_PUBLIC_SUPABASE_URL,b=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!a||!b)throw Error("Missing Supabase environment variables");return(0,d.UU)(a,b,{auth:{persistSession:!1}})}},95736:(a,b,c)=>{"use strict";a.exports=c(44870)},96487:()=>{}};